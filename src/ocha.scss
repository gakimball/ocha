@import 'util/checks';
@import 'util/comparison';
@import 'util/deep-property';
@import 'util/string';
@import 'util/true';
@import 'functions/comparison';
@import 'functions/flags';
@import 'functions/inspection';
@import 'functions/keys';
@import 'functions/language';
@import 'functions/type';

$standalone: (
  'ok',
  'true',
  'false',
  'null',
  'empty',
);

@mixin expect($args) {
  $value: nth($args, 1);
  $functions: -ocha-str-slice($args, 2, length($args) - 1);
  $final: nth($args, length($args));

  @if index($standalone, $final) {
    $functions: append($functions, $final);
    $final: null;
  }

  $assertion: (
    value: $value,
    negative: false,
    length: false,
    all: true,
    only: true,
    deep: false,
    result: (),
  );

  // Run assertion functions
  @each $func in $functions {
    @if index($functions, $func) == length($functions) {
      $assertion: call('-ocha-#{$func}', $assertion, $final);
    }
    @else {
      $assertion: call('-ocha-#{$func}', $assertion);
    }
  }

  // Output the final result of the assertion to True
  @include -ocha-true-assert(map-get($assertion, result));
}
